# Call Me 立绘部署白痴版（一步一步照做）

这份文档给“第一次部署”的用户用。  
目标只有一个：**从 0 到可用，看到会动的立绘并能通话**。

## 0. 你需要准备什么

1. MaiBot 工程已能正常启动。
2. `plugins/call_me` 已在工程里。
3. TTS 服务可用（例如 GPT-SoVITS）。
4. 浏览器可访问本机地址。

## 1. 启动 TTS（先做这个）

如果你用 GPT-SoVITS，可参考你当前常用命令：

```powershell
python api_v2.py -a 127.0.0.1 -p 9880 -c GPT_SoVITS/configs/tts_infer.yaml
```

启动后先记住：**TTS 地址是 `http://127.0.0.1:9880`**。

## 2. 检查 Call Me 配置

打开：`plugins/call_me/config.toml`

至少确认这几项：

```toml
[server]
host = "127.0.0.1"
port = 8989

[tts]
api_url = "http://127.0.0.1:9880"
```

如果你端口不同，就按你自己的实际地址改。

## 3. 启动 MaiBot（带上插件）

用你平时方式启动 MaiBot（例如项目根目录运行）：

```powershell
python bot.py
```

然后在聊天里执行：

1. `/callme status`（看状态）
2. 如果没启动：`/callme start`

## 4. 打开网页确认服务活着

浏览器访问下面 3 个地址：

1. `http://127.0.0.1:8989/docs`（能打开 Swagger 就说明后端活着）
2. `http://127.0.0.1:8989/`（主界面）
3. `http://127.0.0.1:8989/settings/avatar-studio`（立绘工作台）

有一个打不开就先别继续，先看本文最后“故障速查”。

## 5. 第一次立绘配置（最简成功路径）

只做最小步骤，先成功再说。

1. 进入 `立绘工作台`。
2. 在“角色管理”里输入名字，点“新建”。
3. 选中新角色，点“设为激活”。
4. 在“整图素材（fullMap）”里：
   - 情绪选 `neutral`
   - 选一张立绘图
   - 点“上传整图”
5. 点“保存发布”。
6. 回到首页 `/` 看立绘是否显示。

到这一步就已经部署成功了。

## 6. 让立绘“更像活的”（可选）

在工作台继续做这几步：

1. 动作参数里调：
   - 呼吸振幅（先用 3~5）
   - 轻摆角度（先用 0.8~1.5）
2. 触区编辑里点“新增触区”，再保存发布。
3. 回首页点击立绘，确认有触摸反馈动画。

## 7. 口型和眨眼增强（可选，但推荐）

再上传 5 张部件图（都用 `emotion=all`）：

1. `eyes_open`
2. `eyes_closed`
3. `mouth_closed`
4. `mouth_half`
5. `mouth_open`

每上传一批后都点一次“保存发布”。

## 8. 你每次改完都要做的 3 件事

1. 确认当前角色是“激活角色”。
2. 点了“保存发布”。
3. 回首页做一次真实测试（接通 + 说一句话 + 点一下立绘）。

## 9. 故障速查（按现象查）

### 现象 A：页面能开，但没有立绘

按顺序检查：

1. 是否给 `neutral` 上传过整图。
2. 是否点了“保存发布”。
3. 是否“设为激活”。
4. 刷新浏览器重试。

### 现象 B：立绘有，但说话时嘴不动

1. 先确认通话状态能进入 `speaking`。
2. 提高“口型灵敏度”（先拉到 1.2 左右）。
3. 上传 `mouth_closed/mouth_half/mouth_open` 三档部件。

### 现象 C：点击立绘没反馈

1. 工作台里是否有触区。
2. 触区是否启用。
3. 是否保存发布。

### 现象 D：`/docs` 打不开

1. Call Me 没启动：用 `/callme status`、`/callme start`。
2. 8989 被占用：改 `config.toml` 端口并重启。

### 现象 E：能连接但没声音

1. TTS 服务没起：检查 `http://127.0.0.1:9880` 是否可访问。
2. `config.toml` 的 `tts.api_url` 是否写对。

## 10. 建议你下一步做什么

如果你已经跑通，下一步建议：

1. 每个情绪补 1 张整图（happy/sad/angry/shy/surprised）。
2. 再补眼睛和嘴型部件，沉浸感会明显提升。
3. 最后再做触区精调和部件位置微调。

---

详细版说明请看：`plugins/call_me/AVATAR_STUDIO_USER_GUIDE_CN.md`
